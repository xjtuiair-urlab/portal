---
// src/layouts/SidebarLayout.astro
import Layout from './Layout.astro';

const { title, bannerTitle, category = "research" } = Astro.props;

// 路径处理
const rawBase = import.meta.env.BASE_URL;
const baseUrl = rawBase.endsWith('/') ? rawBase.slice(0, -1) : rawBase;
const fixPath = (path) => `${baseUrl}/${path.startsWith('/') ? path.slice(1) : path}`;

// 侧边栏数据 (保持不变...)
const sidebars = {
  research: [
    { name: "Overview", link: "/research" },
    { name: "Brain-machine Interface", link: "/research/bmi" },
    // ...
  ],
  people: [ { name: "Meet our CenBRAINers", link: "/people" }, ],
  contributions: [ { name: "Publications", link: "/publications" }, ]
};

const currentMenu = sidebars[category] || sidebars['research'];
const currentPath = Astro.url.pathname;
---

<Layout title={title}>
    
    <!-- ✅ 1. 顶部 Banner 区域 -->
    <!-- 动态插入 qujiang.png 作为背景 -->
    <div class="page-banner" style={`background-image: url('${fixPath("assets/images/qujiang.png")}')`}>
        <div class="banner-overlay"></div>
        <div class="banner-content">
            <h1>{bannerTitle || title}</h1>
            <!-- 模仿目标网站的橙色横条 -->
            <div class="banner-line"></div>
        </div>
    </div>

    <!-- 2. 双栏布局结构 -->
    <div class="inner-layout">
        <aside class="sidebar">
            <div class="sidebar-menu">
                {currentMenu.map((item) => {
                    // 简单的路径匹配逻辑
                    const isActive = currentPath.includes(item.link) && item.link !== baseUrl; 
                    return (
                        <a href={fixPath(item.link)} class={isActive ? "active" : ""}>
                            {item.name}
                        </a>
                    )
                })}
            </div>
        </aside>

        <main class="main-content">
            <h2 class="content-title">{title}</h2>
            <slot />
        </main>
    </div>
</Layout>

<style>
    /* ✅ Banner 样式 */
    .page-banner {
        position: relative;
        /* 宽度100%，高度固定（可调整） */
        width: 100%;
        height: 350px; 
        
        /* 背景图裁剪逻辑 */
        background-size: cover; 
        background-position: center center;
        background-repeat: no-repeat;
        
        display: flex;
        align-items: center; /* 垂直居中 */
        justify-content: flex-start; /* 左对齐 */
        
        /* 给 Header 留出空间，防止 Header 盖住文字 */
        padding-top: 60px; 
    }

    /* 黑色半透明遮罩，保证白色文字在任何图片上都看得清 */
    .banner-overlay {
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background: linear-gradient(to right, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 100%);
        z-index: 1;
    }

    .banner-content {
        position: relative;
        z-index: 2;
        max-width: var(--max-width);
        margin: 0 auto;
        padding: 0 40px;
        width: 100%;
    }

    .page-banner h1 {
        font-family: var(--font-heading);
        font-size: 3.5rem; /* 大字体 */
        font-weight: 700;
        color: #ffffff;
        margin: 0;
        line-height: 1.2;
        text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    .banner-line {
        width: 80px;
        height: 6px;
        background-color: var(--accent-orange);
        margin-top: 20px;
    }

    /* 布局样式 */
    .inner-layout {
        display: flex;
        gap: 60px;
        padding: 80px 40px;
        max-width: var(--max-width);
        margin: 0 auto;
    }

    .sidebar { flex: 0 0 280px; }

    .sidebar-menu {
        border-right: 1px solid #eee;
        padding-right: 20px;
    }

    .sidebar-menu a {
        display: block;
        padding: 15px 0;
        color: #666;
        font-family: var(--font-heading);
        font-weight: 500;
        font-size: 16px;
        border-bottom: 1px solid #eee;
        transition: 0.3s;
    }

    .sidebar-menu a:hover, .sidebar-menu a.active {
        color: var(--primary-blue);
        padding-left: 10px; /* 悬停时轻微右移 */
        font-weight: 600;
    }

    .main-content { flex: 1; }

    .content-title {
        font-size: 2.5rem;
        color: var(--primary-blue);
        margin-bottom: 30px;
        font-weight: 600;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
    }

    /* 移动端适配 */
    @media (max-width: 768px) {
        .page-banner { height: 250px; }
        .page-banner h1 { font-size: 2rem; }
        .inner-layout { flex-direction: column; padding: 40px 20px; }
        .sidebar { width: 100%; order: 2; margin-top: 40px; }
        .sidebar-menu { border-right: none; border-top: 1px solid #eee; }
        .main-content { order: 1; }
    }
</style>
